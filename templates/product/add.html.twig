{% extends 'dashboard/base.html.twig' %}

{% block body %}
  <div class="container">
    <h1>Add Product</h1>
    {{ form_start(form) }}
    <div class="row">
      <div class="col-sm-6">
        <div class="form-group">
          {{ form_label(form.name) }}
          {{ form_widget(form.name, {'attr': {'class': 'form-control'}}) }}
        </div>
        <div class="form-group">
          {{ form_label(form.description) }}
          {{ form_widget(form.description, {'attr': {'class': 'form-control'}}) }}
        </div>
        <div class="form-group">
          {{ form_label(form.price) }}
          {{ form_widget(form.price, {'attr': {'class': 'form-control'}}) }}
        </div>
      </div>
      <div class="col-sm-6">
        <h3>Product Variants</h3>
        <div id="product-variants-wrapper"
             data-prototype="{{ form_widget(form.productVariants.vars.prototype)|e('html_attr') }}"
             data-index="{{ form.productVariants|length }}">
          <div id="product-variants-entries">
            {% for productVariantForm in form.productVariants %}
              <div class="product-variants-entry">
                {{ form_row(productVariantForm.name) }}
                {{ form_row(productVariantForm.price) }}
                <button type="button" class="btn btn-danger" data-entry-remove>Remove</button>
              </div>
            {% endfor %}
          </div>
          <button type="button" class="btn btn-primary" id="add-product-variant">Add Variant</button>
        </div>
      </div>
    </div>
    <button type="submit" class="btn btn-primary">Save</button>
    {{ form_end(form) }}
  </div>
{% endblock %}

{% block footerJs %}
  {{ parent() }}
  <script>
    // Add new product variant form
let addProductVariantButton = document.querySelector('#add-product-variant');
let productVariantsWrapper = document.querySelector('#product-variants-wrapper');
addProductVariantButton.addEventListener('click', function () {
  let prototype = productVariantsWrapper.dataset.prototype;
  let index = productVariantsWrapper.dataset.index;
  let newForm = prototype.replace(/__name__/g, index);
  productVariantsWrapper.dataset.index = parseInt(index) + 1;

  let newFormWrapper = document.createElement('div');
  newFormWrapper.innerHTML = newForm;
  let newFormElement = newFormWrapper.firstChild;

  // Add Bootstrap classes to new form element and its children
  newFormElement.classList.add('product-variants-entry', 'mb-3', 'p-3', 'border', 'border-secondary', 'rounded');
  let inputElements = newFormElement.querySelectorAll('input, select, textarea');
  inputElements.forEach(function (inputElement) {
    inputElement.classList.add('form-control');
  });

  let productVariantsEntries = productVariantsWrapper.querySelector('#product-variants-entries');
  productVariantsEntries.appendChild(newFormElement);

  let removeButtons = newFormElement.querySelectorAll('[data-entry-remove]');
  removeButtons.forEach(function (removeButton) {
    removeButton.addEventListener('click', function () {
      removeButton.closest('.product-variants-entry').remove();
    });
  });
});

  </script>
{% endblock %}
